#!/bin/bash

# Путь к этому скрипту
dir="$(dirname "$0")"

# Путь к каталогу с архивом
archive_dir="$dir/.deleted_files"

# Путь к файлу с информацией об удаленных файлах
log_file="$dir/.removed-files"

# Создание каталога с архивом, если его нет
mkdir -p "$archive_dir"

# Проверка наличия аргументов (удаляемых файлов)
if [ $# -eq 0 ]; then
    echo "Не переданы файлы! Используйте: $0 файл1 [файл2 файл3 ...]"
    exit 1
fi

# Запись информации об удаленных файлах в журнал (.removed-files)
echo "Дата удаления: $(date)" >> "$log_file"
echo "Удаленные файлы:" >> "$log_file"

# Перебор переданных аргументов (удаляемых файлов)
for file in "$@"; do
    # Проверка существования файла
    if [ -e "$file" ]; then
        # Создание уникального имени для архива (используя время удаления)
        archive_name="${archive_dir}/$(date +"%Y%m%d_%H%M%S")_$(basename "$file")"

        # Архивирование файла
        mv "$file" "$archive_name"

        # Запись информации об удаленном файле в журнал
        echo "$archive_name" >> "$log_file"

        echo "Файл \"$file\" успешно удален и архивирован как \"$archive_name\"."
    else
        echo "Файл \"$file\" не существует. Пропуск."
    fi
done

echo "Операция завершена."

